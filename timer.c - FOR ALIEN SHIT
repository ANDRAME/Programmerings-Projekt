

#include "timer.h"
#include "ansi.h"
#include "alien.h"
#include "stm32f30x_conf.h" // STM32 config
#include "30010_io.h" // Input/output library for this course


volatile time_s gTime;
volatile uint8_t gTimeFlag=0;

void setUPTimer(void){
	RCC->APB2ENR |= RCC_APB2Periph_TIM15; // Enable clock line to timer 15;
	 TIM15->CR1 = 0x0001; // Configure timer 15
	 TIM15->ARR = 63999; // Set reload value
	 TIM15->PSC = 9; // Set pres
	 TIM15->DIER |= 0x0001; // Enable timer 15 interrupts

}
void stopTimer(void){
	NVIC_DisableIRQ(TIM1_BRK_TIM15_IRQn);
}
void startTimer (void){
	NVIC_EnableIRQ(TIM1_BRK_TIM15_IRQn); //enable interrupt
}

void TIM1_BRK_TIM15_IRQHandler(void) {
	gTimeFlag = 1;
	//tells the STM32 the to put gTimeFlag to=1 everytime it is triggered

	TIM15->SR &= ~0x0001; // Clear interrupt bit
 }


/*
void resetTime(){
	gTime.h=0;
	gTime.m=0;
	gTime.s=0;
	gTime.hs=0;
}
*/

/*
for exercise 6
void counting(void)
{
	if (gTime.hs >= 100) {
		gTime.hs = 0;
		gTime.s++;
		if (gTime.s >= 60) {
			gTime.s = 0;
			gTime.m++;
			if (gTime.m >= 60) {
				gTime.m = 0;
				gTime.h++;
				if (gTime.h >= 24) {
					gTime.h = 0;
				}
			}
		}
	}
}


*/


